<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>行動任務處理 - 資料補傳 - 賠案明細</title>
  <style>
    :root{
      --bg:#f5f6f8; --card:#fff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --brand:#2563eb; --brand-weak:#eff6ff; --ok:#059669; --warn:#ea580c; --muted-bg:#f3f4f6;
      --radius:10px; --r-sm:8px; --shadow:0 1px 4px rgba(0,0,0,.08);
      --fs-xxs:.78rem; --fs-xs:.86rem; --fs-sm:.92rem; --fs-md:1rem; --fs-lg:1.125rem; --fs-xl:1.25rem;
      --gap-1:6px; --gap-2:10px; --gap-3:14px; --gap-4:16px; --gap-5:20px;
      --keyw:140px; --keyw-m:110px;
    }

    /* base */
    html,body{height:100%}
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans TC", "PingFang TC", sans-serif; margin:0; padding:20px; background:var(--bg); color:var(--text)}
    h2{margin:0 0 12px; display:flex; align-items:center; gap:10px; font-size:var(--fs-lg)}

    /* card */
    .card{background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:var(--shadow); margin:0 auto 16px; max-width:1000px}

    /* buttons */
    .btn-row{display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:18px auto; max-width:1000px}
    .btn{padding:10px 16px; border:none; border-radius:8px; font-size:var(--fs-md); color:#fff; cursor:pointer}
    .btn-primary{background:var(--brand)}

    /* tabs */
    .tab-card{padding:0}
    .tab-nav{display:flex; gap:6px; overflow-x:auto; white-space:nowrap; border-bottom:1px solid var(--line); padding:10px; border-top-left-radius:var(--radius); border-top-right-radius:var(--radius); background:var(--card)}
    .tab-btn{border:none; background:var(--muted-bg); color:#111; padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:600}
    .tab-btn[aria-selected="true"]{background:#fff; box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .tab-panels{padding:16px 20px 20px}
    .tab-panel{display:none}
    .tab-panel.active{display:block}

    /* kv grid */
    .kv{display:grid; grid-template-columns: var(--keyw) 1fr; gap:8px 16px}
    .k{color:var(--muted); font-size:var(--fs-sm); text-align:right}
    .v{font-size:var(--fs-md)}

    /* sub-cards for arrays */
    .sub-card{border:1px solid var(--line); border-radius:var(--r-sm); padding:12px 14px; margin:10px 0; background:#fafafa}
    .sub-title{font-weight:700; margin:4px 0 12px}

    /* pretty header */
    .head{padding:16px 18px}
    .head-top{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px}
    .claim-strong{font-size:var(--fs-xl); font-weight:800; letter-spacing:.5px}
    .muted{color:var(--muted)}

    /* chips & badges */
    .chip{display:inline-block; padding:2px 8px; border-radius:999px; background:var(--muted-bg); font-size:var(--fs-xs); margin-right:6px}
    .badge{display:inline-block; padding:2px 10px; border-radius:999px; font-size:var(--fs-xs); border:1px solid var(--line)}
    .badge-processing{background:#fff7ed; color:#9a3412; border-color:#fed7aa}
    .badge-done{background:#ecfdf5; color:#065f46; border-color:#a7f3d0}

    /* truncation */
    .clamp-2{display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}
    .link-sm{font-size:var(--fs-xs); margin-left:8px; background:none; border:none; color:var(--brand); cursor:pointer}

    /* journal kv smaller */
    .kv.kv-tight{gap:6px 14px}

    /* mobile */
    @media (max-width: 767px){
      body{padding:16px}
      .kv{grid-template-columns: var(--keyw-m) 1fr}
      .k{text-align:left}
      .btn{width:100%}
      .chip{margin-bottom:6px}
      .head-top{align-items:flex-start}
    }
	.divider{
	  grid-column: 1 / -1;
	  height: 1px;
	  background: var(--line);
	  margin: 8px 0 6px;
	}	
	
	/* 分隔線：在「索賠人」後的那條 */
	.basic-sep {
	  border: 0;
	  border-top: 1px dashed #d8dbe0;
	  margin: 14px 0 18px;
	}

	/* key-value 整體 */
	.kv-grid {
	  display: grid;
	  grid-template-columns: 1fr 1fr;   /* 兩欄 */
	  gap: 10px 18px;
	  margin-bottom: 12px;
	}
	.kv-row {
	  display: grid;
	  grid-template-columns: 120px 1fr; /* 左窄右寬 */
	  align-items: center;
	  min-height: 32px;
	  background: #fff;
	  padding: 6px 10px;
	  border: 1px solid #eef0f3;
	  border-radius: 8px;
	}
	.kv-key {
	  color: #6b7280; /* 次要字色 */
	  font-size: 0.92rem;
	}
	.kv-val {
	  font-weight: 600;
	  word-break: break-all;
	}

	/* 卡片外觀 */
	.info-card {
	  border: 1px solid #e6e9ef;
	  border-radius: 12px;
	  background: #fafbfc;
	  margin: 14px 0 8px;
	  overflow: hidden;
	  box-shadow: 0 1px 2px rgba(0,0,0,0.03);
	}
	.info-card-head {
	  padding: 10px 12px;
	  background: #f3f5f8;
	  border-bottom: 1px solid #e6e9ef;
	}
	.info-card-title {
	  font-weight: 700;
	  font-size: 1rem;
	  letter-spacing: 0.02em;
	}

	/* 卡片內的 grid 讓邊距對齊 */
	.info-card .kv-grid {
	  padding: 12px;
	  margin-bottom: 0;
	}

	/* 手機優化：單欄 + 行高友善 */
	@media (max-width: 767px) {
	  .kv-grid {
		grid-template-columns: 1fr;   /* 單欄 */
		gap: 8px;
	  }
	  .kv-row {
		grid-template-columns: 90px 1fr;
		min-height: 38px;
		padding: 8px 10px;
	  }
	  .info-card-title {
		font-size: 0.98rem;
	  }
	}
	
	/* ===== 基本資料：極簡模式，不要每列的方框 ===== */
	#panel-basic.basic-compact .kv-grid {
	  gap: 6px 16px;            /* 緊湊一點 */
	  margin-bottom: 10px;
	}

	#panel-basic.basic-compact .kv-row {
	  /* 拿掉背景、邊框、圓角 */
	  background: transparent;
	  border: 0;
	  border-radius: 0;
	  padding: 2px 0;           /* 幾乎只留行距 */
	  min-height: unset;
	  display: grid;
	  grid-template-columns: 92px 1fr;   /* 左短右長，桌機再放寬 */
	}

	#panel-basic.basic-compact .kv-row + .kv-row {
	  /* 輕量分隔，不是框框 */
	  border-top: 1px dotted #eceff3;
	  padding-top: 6px;
	  margin-top: 6px;
	}

	#panel-basic.basic-compact .kv-key {
	  color: #8a94a3;
	  font-weight: 500;
	  font-size: 0.92rem;
	}

	#panel-basic.basic-compact .kv-val {
	  font-weight: 600;
	  word-break: break-word;
	}

	/* 卡片外層保留群組感，內層一樣去框 */
	#panel-basic.basic-compact .info-card {
	  border: 1px solid #e6e9ef;
	  background: #f7f9fb;      /* 很淡的底，幫助視線分組 */
	  margin: 12px 0 10px;
	  border-radius: 12px;
	}

	#panel-basic.basic-compact .info-card .kv-grid {
	  padding: 10px 12px;
	}

	#panel-basic.basic-compact .info-card .kv-row {
	  background: transparent;
	  border: 0;
	  border-radius: 0;
	  padding: 2px 0;
	  grid-template-columns: 72px 1fr;   /* 卡片內 label 更短一點 */
	}

	#panel-basic.basic-compact .info-card .kv-row + .kv-row {
	  border-top: 1px dotted #e9edf2;
	  padding-top: 6px;
	  margin-top: 6px;
	}

	/* 手機：單欄、留一點觸控空間就好 */
	@media (max-width: 767px) {
	  #panel-basic.basic-compact .kv-grid {
		grid-template-columns: 1fr;
		gap: 6px;
	  }
	  #panel-basic.basic-compact .kv-row {
		grid-template-columns: 88px 1fr;
		padding: 4px 0;
	  }
	  #panel-basic.basic-compact .info-card .kv-row {
		grid-template-columns: 68px 1fr;
	  }
	}
	
  </style>
</head>
<body>
  <h2>賠案明細</h2>

  <!-- Header 美化版 -->
  <div class="card head" id="claim-header-card"></div>

  <!-- 中間：二顆按鈕（保持不動） -->
  <div class="btn-row">
    <button class="btn btn-primary" onclick="location.href='03.claim_log_upload.html'">日誌新增</button>
    <button class="btn btn-primary" onclick="location.href='03.claim_file_upload.html'">檔案上傳</button>
  </div>

  <!-- Tabs -->
  <div class="card tab-card" role="region" aria-label="賠案資訊切換">
    <div class="tab-nav" role="tablist">
      <button class="tab-btn" role="tab" aria-selected="true" aria-controls="panel-basic" id="tab-basic">基本資料</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-accident" id="tab-accident">事故資料</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-coverage" id="tab-coverage">承保內容</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-log" id="tab-log">日誌</button>
    </div>
    <div class="tab-panels">
      <section id="panel-basic" class="tab-panel active" role="tabpanel" aria-labelledby="tab-basic">
        <div class="kv" id="basicKV"></div>
      </section>
      <section id="panel-accident" class="tab-panel" role="tabpanel" aria-labelledby="tab-accident">
        <div class="kv" id="accidentKV"></div>
        <div id="vehiclesWrap"></div>
        <div id="nonVehiclesWrap"></div>
        <div id="victimsVWrap"></div>
        <div id="victimsCWrap"></div>
      </section>
      <section id="panel-coverage" class="tab-panel" role="tabpanel" aria-labelledby="tab-coverage">
        <div id="policyCoverageWrap"></div>
      </section>
      <section id="panel-log" class="tab-panel" role="tabpanel" aria-labelledby="tab-log">
        <div id="journalWrap"></div>
      </section>
    </div>
  </div>

  <script>

    // ======= 內嵌 sample（不使用 fetch）。實際串接時改由 API 回傳 =======
    const sample = {
      "procSerial":"1",
      "retCode":"000",
      "retMsg":"呼叫成功",
      "claimData":[
        {
          "claimNo":"01078966",
          "clmAccDt":"20201101",
          "clmAccTM":"10",
          "clmRepNm":"林承辦",
          "insuredNm":"被保險某人",
          "issueBrhCD":"27",
          "handleBrhCD":"20",
          "caseSummary":"保車停等紅燈遭後方財車碰撞，其實是個很長的故事，需要很長的內容測試收合功能。",
          "payStat":[{"premiumCls":"TPL","reserveCD":"32","lossOutstanding":"0.00","deductible":"0","lossPaid":"15,000.00","lossInCurr":"15,000.00"}],
          "lossCauseDesc":"13碰撞，傾覆 – 第三人過失",
          "claimant":"陳某人",
          "addInsuredNm":"",
          "limitDriver":"",
          "insuredHomeTel":"",
          "insuredMobile":"0905123456",
          "insuredAddr":"台北市中山區松江路126號",
          "applicantNm":"陳某人",
          "applicantHomeTel":"",
          "applicantMobile":"0905123456",
          "claimState":"1處理中",
          "insEffDt":"20210701",
          "insExpDtexpDt":"20220701",
          "clmRcvDt":"20211122",
          "policyCoverage":[
            {"coverageCD":"B3","coverageDesc":"車體全損免折舊","coverageInsAmtDesc":"賠償最高限額","coverageInsAmt":"249,000","coverageDeduct":"52","coverageInsPrm":"178"},
            {"coverageCD":"C3","coverageDesc":"車體許可使用免追償","coverageInsAmtDesc":"賠償最高限額","coverageInsAmt":"249,000","coverageDeduct":"52","coverageInsPrm":"190"},
            {"coverageCD":"05","coverageDesc":"車對車碰撞車體損失險","coverageInsAmtDesc":"","coverageInsAmt":"249,000","coverageDeduct":"車碰車免自負額","coverageInsPrm":"12,692"},
            {"coverageCD":"31","coverageDesc":"test險","coverageInsAmtDesc":"","coverageInsAmt":"249,000","coverageDeduct":"無","coverageInsPrm":"10,000"}
          ],
          "policyContents":["乘客險限單一駕駛者一人","加保乙型颱風險自負額20%"],
          "accLoc":"15苗栗縣",
          "clmAccLocation":"苗栗縣苗栗市縣府路縣政府前",
          "policeUnit":"苗栗分局",
          "policeNm":"鍾某人",
          "referClaimNo":"",
          "inputTypDesc":"追償件，需轉法務",
          "regNum":"ABC-0001",
          "mtrTyp":"03自用小客車",
          "makeCD":"3003990 ",
          "mtrYR":"2018",
          "driverNm":"陳某人",
          "driverID":"A123456789",
          "driverSex":"男",
          "accLiabilityPcnt":"50(%) 說明：右轉疏忽 ",
          "driverTEL":"",
          "driverMobile":"0905123456",
          "vehicles":[{"contRegNum":"XYZ-001","contDriverNm":"許小姐","contDriverID":"F223456789","contDriverSex":"女","contDriverAdrs":"","contAccLibilityPcnt":"50(%) 說明：右轉疏忽 ","contDriverTEL":"","contDriverMobile":"0918123456"}],
          "nonVehicles":[{"pdNonVehicle":"電線桿","pdAccLibilityPcnt":"","ownerNm":"苗栗縣政府","ownerTEL":""}],
          "victimsV":[{"victimDamageTypCD":"","victimAccLibilityPcnt":"","victimNm":"許小姐","victimMobile":"0918123456","victimSex":"女"}],
          "victimsC":[],
          "journal":[{"seqNo":1,"inputDt":"20201101 14:05:32","handleelDt":"20201101","handleelItemCD":"15","handleelItemDesc":"SMS 發送簡訊","contactNm":"陳某人","contentMatters":"XXXXXX","handlerUsrID":"","handlerUsrNm":"","inputUsrID":"","inputUsrNm":""}],
          "transLog":[{"seqNo":1,"tranNo":"0001","inputDt":"20211122","hostUsrAcnt":"PMA1","hostUsrNm":"李某人","clmRepID":"OP001","clmRepNm":"張某人","tranDesc":"賠案登錄","reasonDesc":"","premiumCls":"TPL","reserveCD":"32","lossPaid":"0.00","revbal":"25,000.00","chgbal":"25,000.00"},{"seqNo":2,"TranNo":"0002","inputDt":"20211123","hostUsrAcnt":"PMA1","hostUsrNm":"李某人","clmRepID":"OP001","clmRepNm":"張某人","tranDesc":"賠案修正","reasonDesc":"修改RESERVE","premiumCls":" TPL","reserveCD":"32","lossPaid":"0.00","revbal":"-5,000","chgbal":"10,000"}]
        }
      ]
    };

    const data = sample.claimData && sample.claimData.length ? sample.claimData[0] : {};

    // ======= 小工具 =======
	function insertDivider(kvEl, beforeRowIndex){
	  const i = beforeRowIndex * 2; // 一列=2個cell(標籤+值)
	  const d = document.createElement('div');
	  d.className = 'divider';
	  d.setAttribute('role','separator');
	  kvEl.insertBefore(d, kvEl.children[i] || null);
	}
	
	function getValueCellByLabel(kvEl, labelText){
	  // 只掃 .k 標籤，找到後面的第一個兄弟 .v
	  const labels = kvEl.querySelectorAll('.k');
	  const target = labelText.replace(/\s/g,''); // 去空白，避免全形/半形陰謀
	  for (const k of labels){
		const name = k.textContent.trim().replace(/\s/g,'');
		if (name === target){
		  // 下一個就是 value cell（不會被 .divider 影響）
		  return k.nextElementSibling;
		}
	  }
	  return null;
	}
	
    const text = (v) => (v === undefined || v === null || v === "" ? "—" : String(v));

	function fillKV(container, entries) {
	  const frag = document.createDocumentFragment();
	  for (const [k, v] of entries) {
		const kEl = document.createElement('div');
		kEl.className = 'k';
		kEl.textContent = k;

		const vEl = document.createElement('div');
		vEl.className = 'v';              // ← 以前少這行
		vEl.textContent = (v === undefined || v === null || v === '') ? '—' : String(v);

		frag.appendChild(kEl);
		frag.appendChild(vEl);
	  }
	  container.innerHTML = '';
	  container.appendChild(frag);
	}

    function makeSubCard(title) {
      const box = document.createElement('div'); box.className = 'sub-card';
      if (title) { const t = document.createElement('div'); t.className = 'sub-title'; t.textContent = title; box.appendChild(t); }
      return box;
    }

    function yyyymmddToDash(s){ if(!s) return s; const m = String(s).match(/^\d{8}$/); if(!m) return s; return s.slice(0,4)+'-'+s.slice(4,6)+'-'+s.slice(6,8); }
    function hhmmFrom(s){ if(!s) return s; const t=String(s); if(t.length===4) return t.slice(0,2)+":"+t.slice(2,4); if(t.length<=2) return t.padStart(2,'0')+":00"; return t; }

    // ======= Header（美化渲染） =======
    function renderHeader() {
      const card = document.getElementById('claim-header-card');
      card.innerHTML = '';

      // top row: claimNo + status badge
      const top = document.createElement('div'); top.className = 'head-top';
      const left = document.createElement('div');
      const label = document.createElement('div'); label.className = 'muted'; label.textContent = '賠案號碼';
      const strong = document.createElement('div'); strong.className = 'claim-strong'; strong.textContent = text(data.claimNo);
      left.appendChild(label); left.appendChild(strong);

      const right = document.createElement('div');
      const badge = document.createElement('span'); badge.className = 'badge badge-processing'; badge.textContent = text(data.claimState);
      right.appendChild(badge);
      top.appendChild(left); top.appendChild(right);
      card.appendChild(top);

      // kv rows
		const kv = document.createElement('div'); 
		kv.className = 'kv kv-tight';
		const dt = [yyyymmddToDash(data.clmAccDt), hhmmFrom(data.clmAccTM)].filter(Boolean).join(' ');
		fillKV(kv, [
		  ['出險時間', dt],
		  ['承辦人員', data.clmRepNm],
		  ['單位代號', null],
		  ['被保險人', data.insuredNm],
		  ['案情摘要', null]
		]);

		// 在「被保險人」那列前插入分隔線（0:出險,1:承辦,2:單位,3:被保,4:摘要）
		insertDivider(kv, 3);
		card.appendChild(kv);
		
		// 單位 chip
		const unitCell = getValueCellByLabel(kv, '單位代號');
		unitCell.textContent = '';
		const chip1 = document.createElement('span'); chip1.className='chip'; chip1.textContent = '出單 ' + text(data.issueBrhCD);
		const chip2 = document.createElement('span'); chip2.className='chip'; chip2.textContent = '處理 ' + text(data.handleBrhCD);
		unitCell.appendChild(chip1); unitCell.appendChild(chip2);

		// 案情摘要（兩行截斷 + 展開）
		const caseCell = getValueCellByLabel(kv, '案情摘要');
		caseCell.textContent = '';
		const summary = document.createElement('div'); summary.className='clamp-2'; summary.textContent = text(data.caseSummary);
		const btn = document.createElement('button'); btn.className='link-sm'; btn.textContent='展開';
		let expanded = false;
		btn.addEventListener('click', ()=>{
		  expanded = !expanded;
		  summary.style.display = expanded ? 'block' : '';
		  btn.textContent = expanded ? '收合' : '展開';
      });
	  
      caseCell.appendChild(summary); 
	  caseCell.appendChild(btn);
    }

	// ======= 基本資料（4.10 ~ 4.24） =======
	function renderBasic() {
	  const root = document.getElementById('panel-basic'); // 這個才是面板
	  if (!root) return;
	  root.innerHTML = '';
	  root.classList.add('basic-compact');   // ← 新增：開啟精簡樣式

		// 用外層的 data；只留 insExp 推導
		const insExp = data.insExpDt || data.insExp || '';

	  // 1) 上半段：一般欄位 + 在「索賠人」後自動分隔
	  const basicPairsTop = [
		['收件日期', safe(yyyymmddToDash(data.clmRcvDt))],
		['起保日期', safe(yyyymmddToDash(data.insEffDt))],
		['到期日期', safe(yyyymmddToDash(insExp))],
		['出險原因', safe(data.lossCauseDesc)],
		['索賠人',   safe(data.claimant)]
	  ];
	  root.appendChild(makeKVGrid(basicPairsTop));

	  // 分隔線
	  root.appendChild(makeDivider());

	  // 2) 分隔後的續列欄位
	  const basicPairsBottom = [
		['附加被保險人', safe(data.addInsuredNm)],
		['限定駕駛人',   safe(data.limitDriver)]
	  ];
	  root.appendChild(makeKVGrid(basicPairsBottom));

	  // 3) 被保險人資訊卡片（簡短 label）
	  root.appendChild(makeInfoCard('被保險人資訊', [
		['姓名',     safe(data.insuredNm)],
		['室內電話', safe(data.insuredHomeTel)],
		['行動電話', safe(data.insuredMobile)],
		['地址',     safe(data.insuredAddr)]
	  ]));

	  // 4) 要保人資訊卡片（同規格）
	  root.appendChild(makeInfoCard('要保人資訊', [
		['姓名',     safe(data.applicantNm)],
		['室內電話', safe(data.applicantHomeTel)],
		['行動電話', safe(data.applicantMobile)],
		['地址',     safe(data.applicantAddr)]
	  ]));
	}

	/* ===== 小工具區：不污染你原有命名 ===== */
	function safe(v){ return (v === null || v === undefined || v === '') ? '—' : String(v); }

	function el(tag, className, text){
	  const n = document.createElement(tag);
	  if (className) n.className = className;
	  if (text !== undefined) n.textContent = text;
	  return n;
	}

	function makeDivider(){
	  return el('hr', 'basic-sep');
	}

	// key-value grid（兩欄；手機自動單欄）
	function makeKVGrid(pairs){
	  const wrap = el('div', 'kv-grid');
	  pairs.forEach(([k, v]) => {
		const row = el('div', 'kv-row');
		row.appendChild(el('div', 'kv-key', k));
		const val = el('div', 'kv-val');
		val.textContent = v;
		row.appendChild(val);
		wrap.appendChild(row);
	  });
	  return wrap;
	}

	// 卡片：含標題 + 內部 key-value grid
	function makeInfoCard(title, pairs){
	  const card = el('section', 'info-card');
	  const head = el('div', 'info-card-head');
	  head.appendChild(el('div', 'info-card-title', title));
	  card.appendChild(head);
	  card.appendChild(makeKVGrid(pairs));
	  return card;
	}


    // ======= 事故資料（4.27 ~ 4.46） + 各 array 區塊 =======
    function renderAccident() {
      const kv = document.getElementById('accidentKV');
      fillKV(kv, [
        ['出險地點', data.accLoc],
        ['出險詳細位置', data.clmAccLocation],
        ['警方單位', data.policeUnit],
        ['警員姓名', data.policeNm],
        ['任意/強制險賠案號', data.referClaimNo],
        ['案件類型', data.inputTypDesc],
        ['保車車號', data.regNum],
        ['車輛種類', data.mtrTyp],
        ['廠牌車型', data.makeCD],
        ['製造年份', data.mtrYR],
        ['保車駕駛人姓名', data.driverNm],
        ['保車駕駛ID', data.driverID],
        ['保車駕駛性別', data.driverSex],
        ['保車肇責比例', data.accLiabilityPcnt],
        ['保車駕駛室內電話', data.driverTEL],
        ['保車駕駛行動電話', data.driverMobile],
      ]);

      const vehicles = Array.isArray(data.vehicles) ? data.vehicles : [];
      const vWrap = document.getElementById('vehiclesWrap'); vWrap.innerHTML = '';
      if (vehicles.length) {
        const title = document.createElement('div'); title.className='muted'; title.textContent='財車資料 vehicles'; vWrap.appendChild(title);
        vehicles.forEach((v, i) => {
          const box = makeSubCard(`財車 ${i+1}`);
          const kv = document.createElement('div'); kv.className='kv';
          fillKV(kv, [
            ['財車車號', v.contRegNum],
            ['財車駕駛人姓名', v.contDriverNm],
            ['財車駕駛ID', v.contDriverID],
            ['財車駕駛性別', v.contDriverSex],
            ['財車駕駛地址', v.contDriverAdrs],
            ['財車肇責比例', v.contAccLibilityPcnt],
            ['財車駕駛室內電話', v.contDriverTEL],
            ['財車駕駛行動電話', v.contDriverMobile],
          ]);
          box.appendChild(kv); vWrap.appendChild(box);
        });
      }

      const nonV = Array.isArray(data.nonVehicles) ? data.nonVehicles : [];
      const nWrap = document.getElementById('nonVehiclesWrap'); nWrap.innerHTML = '';
      if (nonV.length) {
        const title = document.createElement('div'); title.className='muted'; title.textContent='非車財損資料 nonVehicles'; nWrap.appendChild(title);
        nonV.forEach((nv, i) => {
          const box = makeSubCard(`財損 ${i+1}`);
          const kv = document.createElement('div'); kv.className='kv';
          fillKV(kv, [
            ['非車輛財損', nv.pdNonVehicle],
            ['財損肇責比例', nv.pdAccLibilityPcnt],
            ['物主姓名', nv.ownerNm],
            ['物主電話', nv.ownerTEL],
          ]);
          box.appendChild(kv); nWrap.appendChild(box);
        });
      }

      const vV = Array.isArray(data.victimsV) ? data.victimsV : [];
      const vVWrap = document.getElementById('victimsVWrap'); vVWrap.innerHTML = '';
      if (vV.length) {
        const title = document.createElement('div'); title.className='muted'; title.textContent='受害人資料 – 任意險 victimsV'; vVWrap.appendChild(title);
        vV.forEach((vv, i) => {
          const box = makeSubCard(`受害人(任意) ${i+1}`);
          const kv = document.createElement('div'); kv.className='kv';
          fillKV(kv, [
            ['傷情代號', vv.victimDamageTypCD],
            ['受害人肇責比例', vv.victimAccLibilityPcnt],
            ['受害人姓名', vv.victimNm],
            ['受害人行動電話', vv.victimMobile],
            ['受害人性別', vv.victimSex],
          ]);
          box.appendChild(kv); vVWrap.appendChild(box);
        });
      }

      const vC = Array.isArray(data.victimsC) ? data.victimsC : [];
      const vCWrap = document.getElementById('victimsCWrap'); vCWrap.innerHTML = '';
      if (vC.length) {
        const title = document.createElement('div'); title.className='muted'; title.textContent='受害人資料 – 強制險 victimsC'; vCWrap.appendChild(title);
        vC.forEach((vc, i) => {
          const box = makeSubCard(`受害人(強制) ${i+1}`);
          const kv = document.createElement('div'); kv.className='kv';
          fillKV(kv, [
            ['傷情代號', vc.victimDamageTypCD],
            ['受害人肇責比例', vc.victimAccLibilityPcnt],
            ['受害人姓名', vc.victimNm],
            ['受害人行動電話', vc.victimMobile],
            ['受害人性別', vc.victimSex],
          ]);
          box.appendChild(kv); vCWrap.appendChild(box);
        });
      }
    }

    // ======= 承保內容（policyCoverage Array） =======
    function renderCoverage() {
      const wrap = document.getElementById('policyCoverageWrap'); wrap.innerHTML = '';
      const arr = Array.isArray(data.policyCoverage) ? data.policyCoverage : [];
      if (!arr.length) { wrap.textContent = '—'; return; }
      arr.forEach((p, i) => {
        const box = makeSubCard(`承保項目 ${i+1}`);
        const kv = document.createElement('div'); kv.className='kv';
        fillKV(kv, [
          ['險種', p.coverageCD],
          ['保險種類', p.coverageDesc],
          ['給付項目', p.coverageInsAmtDesc],
          ['保險金額', p.coverageInsAmt],
          ['自負額', p.coverageDeduct],
          ['保險費', p.coverageInsPrm],
        ]);
        box.appendChild(kv); wrap.appendChild(box);
      });
    }

    // ======= 日誌（journal Array） =======
    function renderJournal() {
      const wrap = document.getElementById('journalWrap'); wrap.innerHTML = '';
      const arr = Array.isArray(data.journal) ? data.journal : [];
      if (!arr.length) { wrap.textContent = '—'; return; }
      arr.forEach((j) => {
        const box = makeSubCard(`日誌序號 ${j.seqNo ?? ''}`);
        const kv = document.createElement('div'); kv.className='kv';
        const handleDt = j.handleDt || j.handleelDt; // 容錯
        const handleItemCD = j.handleItemCD || j.handleelItemCD;
        const handleItemDesc = j.handleItemDesc || j.handleelItemDesc;
        fillKV(kv, [
          ['輸入日期', j.inputDt],
          ['處理日期', handleDt],
          ['處理項目代號', handleItemCD],
          ['處理項目名稱', handleItemDesc],
          ['聯絡人員姓名', j.contactNm],
          ['處理內容', j.contentMatters],
          ['處理人員代號', j.handlerUsrID],
          ['處理人員姓名', j.handlerUsrNm],
          ['輸入人員代號', j.inputUsrID],
          ['輸入人員姓名', j.inputUsrNm],
        ]);
        box.appendChild(kv); wrap.appendChild(box);
      });
    }

    // ======= Tab 切換 =======
    function initTabs(){
      const tabBtns = document.querySelectorAll('.tab-btn');
      const panels = document.querySelectorAll('.tab-panel');
      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          tabBtns.forEach(b => b.setAttribute('aria-selected', String(b === btn)));
          panels.forEach(p => p.classList.remove('active'));
          const pid = btn.getAttribute('aria-controls');
          document.getElementById(pid).classList.add('active');
        });
      });
    }

    // ======= 進場 =======
    document.addEventListener('DOMContentLoaded', () => {
      renderHeader();
      renderBasic();
      renderAccident();
      renderCoverage();
      renderJournal();
      initTabs();
    });
  </script>
</body>
</html>
