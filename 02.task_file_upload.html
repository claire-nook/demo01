<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>
            è¡Œå‹•ä»»å‹™è™•ç† - æˆ‘çš„ä»»å‹™ - ä»»å‹™æ˜ç´° - æª”æ¡ˆä¸Šå‚³
        </title>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 10px;
                background-color: #f8f8f8;
            }
            h2 {
                margin-bottom: 1em;
            }

            .back-button {
                background: #666;
                color: white;
                border: none;
                border-radius: 4px;
                padding: 6px 12px;
                font-size: 14px;
                cursor: pointer;
                margin: 0 10px 10px 0;
            }

            /* PCç‰ˆè¡¨å–® */
            .pc-form-wrapper {
                max-width: 900px;
                margin: 0 auto;
                background: #fff;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            }
            .form-row {
                display: flex;
                align-items: center;
                margin-bottom: 14px;
                gap: 10px;
            }
            .form-row label {
                min-width: 120px;
                font-weight: bold;
                text-align: right;
            }
            .form-row input,
            .form-row select,
            .form-row textarea {
                flex: 1;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 1rem;
                box-sizing: border-box;
            }

            /* Mobile å¡ç‰‡ */
            .mobile-card {
                background: #fff;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                margin: 0 auto;
            }
            .mobile-card label {
                font-weight: bold;
                margin-top: 10px;
                display: block;
            }
            .mobile-card input,
            .mobile-card select {
                width: 100%;
                padding: 8px;
                margin-top: 4px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            .button-group {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                gap: 10px;
            }
            .button {
                flex: 1;
                padding: 10px;
                border: none;
                color: #fff;
                font-size: 16px;
                border-radius: 4px;
            }
            .button.upload {
                background-color: #fb8c00;
            }
            .button.cancel {
                background-color: #555;
            }

            .pc {
                display: block;
            }
            .mobile-only {
                display: none;
            }

            /* é è¦½å€ï¼ˆPC/Mobile å…±ç”¨ï¼‰ */
            #previewAreaPC,
            #previewAreaMobile {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed #ccc;
                border-radius: 6px;
                background: #fefefe;
                max-height: 200px; /* å›ºå®šé«˜åº¦ï¼Œå¯èª¿æ•´ */
                overflow-y: auto; /* å¤šåœ–æ™‚å¯æ²å‹• */
            }

            #previewAreaPC img,
            #previewAreaMobile img {
                height: 100px;
                border: 1px solid #aaa;
                border-radius: 4px;
                cursor: zoom-in;
            }
            
            .remove-btn {
                position: absolute;
                top: -6px;
                right: -6px;
                background: #e53935;
                color: #fff;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                font-size: 14px;
                line-height: 20px;
                text-align: center;
                cursor: pointer;
                box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
            }

            /* åœ–ç‰‡æ”¾å¤§ Modal */
            #imageModal {
                display: none;
                position: fixed;
                z-index: 999;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                justify-content: center;
                align-items: center;
            }
            #imageModalContent {
                max-width: 90%;
                max-height: 90%;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            }
            #imageModal img {
                width: 100%;
                height: auto;
                border-radius: 8px;
            }
            #imageModal .close {
                position: absolute;
                top: 20px;
                right: 30px;
                font-size: 30px;
                color: #fff;
                cursor: pointer;
            }

            /* === è¡Œå‹•ç‰ˆé—œéµä¿®æ­£ï¼šå¯é»æ“Šé«˜åº¦ & å­—ç´š === */
            @media (max-width: 767px) {
                .pc {
                    display: none;
                }
                .mobile-only {
                    display: block;
                }
                .back-button {
                    font-size: 16px;
                    padding: 10px;
                    width: 100%;
                    margin-top: 10px;
                }

                /* å…ƒä»¶åˆ¥å†æ‰ï¼šiOS é¿å…ç¸®æ”¾ï¼Œå®‰å“ä¹Ÿèˆ’æœ */
                input,
                select,
                textarea,
                button {
                    font-size: 16px !important;
                    height: 44px !important;
                    padding: 10px 12px !important;
                    box-sizing: border-box;
                }
                /* æ–‡å­—å€åŸŸä¿åº•é«˜åº¦ */
                textarea {
                    min-height: 120px !important;
                    height: auto !important;
                    line-height: 1.4;
                }
                label {
                    font-size: 1rem;
                }
                .mobile-card {
                    padding: 16px;
                }
                .button {
                    height: 44px !important;
                    font-size: 16px !important;
                }
                /* é è¦½ç¸®åœ–è¡Œå‹•è£ç½®æ›´å¥½æ»‘ */
                #previewAreaMobile img {
                    height: 96px;
                }
            }
            #summaryPC span,
            #summaryMobile span {
                margin-right: 16px;
            }

            /* çµ±ä¸€é è¦½å¡ç‰‡é¢¨æ ¼ */
            

			.preview-item img {
				width: 100%;
				height: 100%;
				object-fit: cover; /* è‡ªå‹•è£åˆ‡ä¿æ¯”ä¾‹ */
				border-radius: 6px;
			}

            .preview-item .info-box {
                font-size: 12px;
                color: #444;
                background: #f9f9f9;
                padding: 2px 4px;
                border-radius: 4px;
                text-align: center;
                white-space: pre-wrap;
                width: 100%;
                box-sizing: border-box;
                border: 1px dashed #ccc;
            }

            #previewAreaPC,
            #previewAreaMobile {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                padding: 10px;
                border: 1px dashed #ccc;
                background: #fff;
                border-radius: 6px;
                overflow-y: auto;
                max-height: 250px;
            }
        .preview-item {
                background: #fff;
                border-radius: 10px;
                padding: 8px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
                gap: 6px;
                width: 120px;
                height: 100px;
                position: relative;
            }
</style>
    </head>
    <body>
        <button class="back-button pc" onclick="goBack()">
            â† è¿”å›
        </button>
        <div class="mobile-only">
            <button class="back-button" onclick="goBack()">
                â† è¿”å›
            </button>
        </div>
        <h2>
            ä»»å‹™ç·¨è™Ÿ
            <strong>
                123456
            </strong>
        </h2>
        <!-- PCç‰ˆ -->
        <div class="pc-form-wrapper pc">
            <div class="form-row">
                <label>
                    è³ æ¡ˆè™Ÿç¢¼ï¼š
                </label>
                <div>
                    10000001
                </div>
            </div>
            <div class="form-row">
                <label>
                    è»Šç‰Œè™Ÿç¢¼ï¼š
                </label>
                <div>
                    1234-BB
                </div>
            </div>
            <div class="form-row">
                <label for="uploadMode">
                    ä¸Šå‚³æ–¹å¼ï¼š
                </label>
                <select id="uploadMode">
                    <option value="individual">
                        é€å¼µåœ–ç‰‡/é€å€‹æª”æ¡ˆä¸Šå‚³
                    </option>
                    <option value="merge">
                        å¤šå¼µåœ–ç‰‡åˆä½µç‚ºPDFä¸Šå‚³
                    </option>
                </select>
            </div>
            <div class="form-row">
                <label>
                    é¡åˆ¥ï¼š
                </label>
                <select>
                    <option>
                        ä¿æˆ¶
                    </option>
                    <option>
                        å°é€ 1
                    </option>
                    <option>
                        å°é€ 2
                    </option>
                    <option>
                        å…¨é‹’ç¾å ´ç…§
                    </option>
                    <option>
                        æŸ¥è­‰è³‡æ–™
                    </option>
                    <option>
                        è¨´è¨Ÿã€è¿½å„Ÿ
                    </option>
                    <option>
                        æ­»äº¡æŸ¥è­‰
                    </option>
                    <option>
                        å®¢æˆ¶ä¸Šå‚³
                    </option>
                    <option>
                        å…¶ä»–
                    </option>
                </select>
            </div>
            <div class="form-row">
                <label>
                    æª”æ¡ˆèªªæ˜ï¼š
                </label>
                <input type="text" />
            </div>
            <div class="form-row">
                <label for="fileInput">
                    é¸æ“‡æª”æ¡ˆï¼š
                </label>
                <input accept="image/*,application/pdf" id="fileInput" multiple="" type="file" />
            </div>
            <div class="form-row">
                <label>
                    é è¦½åœ–ï¼š
                </label>
                <div id="previewAreaPC"></div>
            </div>
            <div class="form-row">
                <label>
                    å£“ç¸®è³‡è¨Šï¼š
                </label>
                <div id="summaryPC" style="white-space: pre-wrap; font-size: 0.9rem; line-height: 1.6;"></div>
            </div>
            <div class="button-group">
                <button class="button upload" onclick="submitUpload()">
                    ä¸Šå‚³
                </button>
                <button class="button cancel" onclick="goBack()">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
        <!-- Mobileç‰ˆ -->
        <div class="mobile-card mobile-only">
            <div><strong>è³ æ¡ˆè™Ÿç¢¼ï¼š</strong>10000001</div>
            <div><strong>è»Šç‰Œè™Ÿç¢¼ï¼š</strong>1234-BB</div>
            <label>
                ä¸Šå‚³æ–¹å¼ï¼š
            </label>
            <select id="uploadModeMobile">
                <option value="individual">
                    é€å¼µåœ–ç‰‡/é€å€‹æª”æ¡ˆä¸Šå‚³
                </option>
                <option value="merge">
                    å¤šå¼µåœ–ç‰‡åˆä½µç‚ºPDFä¸Šå‚³
                </option>
            </select>
            <label>
                é¡åˆ¥ï¼š
            </label>
            <select>
                <option>
                    ä¿æˆ¶
                </option>
                <option>
                    å°é€ 1
                </option>
                <option>
                    å°é€ 2
                </option>
                <option>
                    å…¨é‹’ç¾å ´ç…§
                </option>
                <option>
                    æŸ¥è­‰è³‡æ–™
                </option>
                <option>
                    è¨´è¨Ÿã€è¿½å„Ÿ
                </option>
                <option>
                    æ­»äº¡æŸ¥è­‰
                </option>
                <option>
                    å®¢æˆ¶ä¸Šå‚³
                </option>
                <option>
                    å…¶ä»–
                </option>
            </select>
            <label>
                æª”æ¡ˆèªªæ˜ï¼š
            </label>
            <input type="text" />
            <label>
                é¸æ“‡æª”æ¡ˆï¼š
            </label>
            <input accept="image/*,application/pdf" id="fileInputMobile" multiple="" type="file" />
            <label>
                é è¦½åœ–ï¼š
            </label>
            <div id="previewAreaMobile"></div>
            <label>
                å£“ç¸®è³‡è¨Šï¼š
            </label>
            <div id="summaryMobile" style="white-space: pre-wrap; font-size: 0.95rem; line-height: 1.6;"></div>
            <div class="button-group">
                <button class="button upload" onclick="submitUpload()">
                    ä¸Šå‚³
                </button>
                <button class="button cancel" onclick="goBack()">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
        <!-- åœ–ç‰‡æ”¾å¤§ Modal -->
        <div id="imageModal">
            <span class="close">
                Ã—
            </span>
            <div id="imageModalContent">
                <img alt="é è¦½åœ–" src="" />
            </div>
        </div>
        <script>
            function goBack() {
                location.href = "02.task_detail_proc.html";
            }

            function submitUpload() {
                if (confirm("æ˜¯å¦ç¢ºèªä¸Šå‚³é€™äº›æª”æ¡ˆï¼Ÿ")) {
                    alert("ä¸Šå‚³æˆåŠŸï¼");
                    location.href = "02.task_detail_proc.html";
                }
            }

            // ç¶å®šæª”æ¡ˆé¸æ“‡äº‹ä»¶
            document.getElementById("fileInput")?.addEventListener("change", (e) => handlePreview(e, "PC"));
            document.getElementById("fileInputMobile")?.addEventListener("change", (e) => handlePreview(e, "Mobile"));

            function handlePreview(event, mode) {
                const previewArea = document.getElementById("previewArea" + mode);
                if (!previewArea) return;
                previewArea.innerHTML = "";

                const files = Array.from(event.target.files);
                files.forEach((file) => {
                    // åªé è¦½åœ–ç‰‡ï¼›PDF ä¸é è¦½ç¸®åœ–
                    if (!file.type.startsWith("image/")) return;

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const container = document.createElement("div");
                        container.className = "preview-item";

                        const img = document.createElement("img");
                        img.src = e.target.result;

                        // é»ç¸®åœ–æ”¾å¤§
                        img.addEventListener("click", () => openModal(img.src));

                        const removeBtn = document.createElement("span");
                        removeBtn.className = "remove-btn";
                        removeBtn.innerHTML = "&times;";
                        removeBtn.onclick = () => container.remove(); // åƒ…ç§»é™¤ç•«é¢é è¦½

                        container.appendChild(img);
                        container.appendChild(removeBtn);
                        previewArea.appendChild(container);
                    };
                    reader.readAsDataURL(file);
                });
            }

            // Modal é‚è¼¯
            function openModal(src) {
                const modal = document.getElementById("imageModal");
                modal.querySelector("img").src = src;
                modal.style.display = "flex";
            }
            document.querySelector("#imageModal .close").onclick = () => (document.getElementById("imageModal").style.display = "none");
            window.addEventListener("click", (evt) => {
                const modal = document.getElementById("imageModal");
                if (evt.target === modal) modal.style.display = "none";
            });
        </script>
        <script>
            async function compressImage(file, quality = 0.7) {
                return new Promise((resolve) => {
                    const img = new Image();
                    const reader = new FileReader();
                    reader.onload = () => {
                        img.src = reader.result;
                    };
                    img.onload = () => {
                        const canvas = document.createElement("canvas");
                        const maxSize = 1280;
                        let { width, height } = img;

                        if (width > height) {
                            if (width > maxSize) {
                                height *= maxSize / width;
                                width = maxSize;
                            }
                        } else {
                            if (height > maxSize) {
                                width *= maxSize / height;
                                height = maxSize;
                            }
                        }

                        canvas.width = Math.floor(width);
                        canvas.height = Math.floor(height);
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL("image/jpeg", quality));
                    };
                    reader.readAsDataURL(file);
                });
            }

            async function handlePreview(event, mode) {
                const previewArea = document.getElementById("previewArea" + mode);
                const summaryBox = document.getElementById("summary" + mode);
                if (!previewArea || !summaryBox) return;

                previewArea.innerHTML = "";
                summaryBox.innerText = "æ­£åœ¨å£“ç¸®ä¸­â€¦è«‹ç¨å€™";

                const files = Array.from(event.target.files);
                if (!files.length) {
                    summaryBox.innerText = "å°šæœªé¸å–æª”æ¡ˆ";
                    return;
                }

                let totalOriginal = 0;
                let totalCompressed = 0;
                let totalTime = 0;

                for (const file of files) {
                    if (!file.type.startsWith("image/")) continue;

                    const originalSizeKB = file.size / 1024;
                    totalOriginal += originalSizeKB;

                    const start = performance.now();
                    const compressedDataUrl = await compressImage(file, 0.7);
                    const end = performance.now();
                    const duration = end - start;
                    totalTime += duration;

                    const compressedSizeKB = Math.round((compressedDataUrl.length * 3) / 4 / 1024);
                    totalCompressed += compressedSizeKB;

                    const container = document.createElement("div");
                    container.className = "preview-item";

                    const img = document.createElement("img");
                    img.src = compressedDataUrl;
                    img.addEventListener("click", () => openModal(img.src));

                    const removeBtn = document.createElement("span");
                    removeBtn.className = "remove-btn";
                    removeBtn.innerHTML = "&times;";
                    removeBtn.onclick = () => container.remove();

/*
                    const infoBox = document.createElement("div");
                    infoBox.className = "info-box";
                    infoBox.style = "font-size: 12px; color: #333; white-space: pre-wrap; margin-top: 4px;";
                    infoBox.innerText = `åŸï¼š${originalSizeKB.toFixed(1)} KB\nå£“ï¼š${compressedSizeKB} KB\nè€—æ™‚ï¼š${duration.toFixed(1)} ms`;
*/
                    container.appendChild(img);
                    container.appendChild(removeBtn);
  //                  container.appendChild(infoBox);
                    previewArea.appendChild(container);
                }

                const count = files.length;
                const ratio = totalCompressed / totalOriginal;
                summaryBox.innerHTML = `
    <span>ğŸ“¸ åœ–ç‰‡ç¸½æ•¸ï¼š${count} å¼µ</span>
    <span>ğŸ“¦ åŸå§‹ç¸½å¤§å°ï¼š${(totalOriginal / 1024).toFixed(2)} MB</span>
    <span>ğŸ—œï¸ å£“ç¸®å¾Œç¸½å¤§å°ï¼š${(totalCompressed / 1024).toFixed(2)} MB</span>
    <span>ğŸ“‰ å£“ç¸®æ¯”ç‡ï¼š${(ratio * 100).toFixed(1)}%</span>
    <span>â±ï¸ ç¸½å£“ç¸®è€—æ™‚ï¼š${(totalTime / 1000).toFixed(1)} ç§’</span>
  `;
            }
        </script>
    </body>
</html>
